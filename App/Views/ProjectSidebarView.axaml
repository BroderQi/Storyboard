<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Storyboard.ViewModels"
             x:Class="Storyboard.Views.ProjectSidebarView"
             x:DataType="vm:MainViewModel">

    <Grid RowDefinitions="Auto,*" Background="#0f0f0f">
        
        <!-- Header: New Project Button -->
        <Border Grid.Row="0" 
                Padding="16" 
                BorderBrush="#27272a" 
                BorderThickness="0,0,0,1">
            <Button Classes="Secondary" 
                    HorizontalAlignment="Stretch"
                    Command="{Binding ShowCreateProjectDialogCommand}">
                <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                    <PathIcon Data="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z" 
                              Width="16" 
                              Height="16" />
                    <TextBlock Text="新建项目" FontSize="13" />
                </StackPanel>
            </Button>
        </Border>

        <!-- Content: Sections -->
        <ScrollViewer Grid.Row="1" Padding="16,16,16,64" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <StackPanel Spacing="16">
                
                <!-- Video Import Section -->
                <Border Background="#18181b" 
                        BorderBrush="#27272a" 
                        BorderThickness="1" 
                        CornerRadius="8" 
                        Padding="16">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <PathIcon Data="M18 3v2h-2V3H8v2H6V3H4v18h2v-2h2v2h8v-2h2v2h2V3h-2zM8 17H6v-2h2v2zm0-4H6v-2h2v2zm0-4H6V7h2v2zm10 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2z" 
                                      Width="16" 
                                      Height="16" 
                                      Foreground="#8b5cf6" />
                            <TextBlock Text="视频导入" 
                                       FontSize="14" 
                                       FontWeight="SemiBold" 
                                       Foreground="#f5f5f5" 
                                       VerticalAlignment="Center" />
                        </StackPanel>
                        
                        <!-- Video Info or Import Button -->
                        <StackPanel Spacing="12" IsVisible="{Binding HasVideoFile, Converter={StaticResource BoolNot}}">
                            <Button Classes="Secondary" 
                                    HorizontalAlignment="Stretch"
                                    Command="{Binding ImportVideoCommand}">
                                <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                                    <PathIcon Data="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z" 
                                              Width="14" 
                                              Height="14" />
                                    <TextBlock Text="导入视频文件" FontSize="13" />
                                </StackPanel>
                            </Button>
                        </StackPanel>
                        
                        <StackPanel Spacing="10" IsVisible="{Binding HasVideoFile}">
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBlock Grid.Column="0" 
                                           Text="时长" 
                                           FontSize="13" 
                                           Foreground="#71717a" />
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding VideoFileDuration}" 
                                           FontSize="13" 
                                           Foreground="#f5f5f5" />
                            </Grid>
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBlock Grid.Column="0" 
                                           Text="分辨率" 
                                           FontSize="13" 
                                           Foreground="#71717a" />
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding VideoFileResolution}" 
                                           FontSize="13" 
                                           Foreground="#f5f5f5" />
                            </Grid>
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBlock Grid.Column="0" 
                                           Text="帧率" 
                                           FontSize="13" 
                                           Foreground="#71717a" />
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding VideoFileFps, StringFormat='{}{0} fps'}" 
                                           FontSize="13" 
                                           Foreground="#f5f5f5" />
                            </Grid>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Frame Extraction Section -->
                <Border Background="#18181b" 
                        BorderBrush="#27272a" 
                        BorderThickness="1" 
                        CornerRadius="8" 
                        Padding="16"
                        IsVisible="{Binding HasVideoFile}">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <PathIcon Data="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14z" 
                                      Width="16" 
                                      Height="16" 
                                      Foreground="#8b5cf6" />
                            <TextBlock Text="抽帧配置" 
                                       FontSize="14" 
                                       FontWeight="SemiBold" 
                                       Foreground="#f5f5f5" 
                                       VerticalAlignment="Center" />
                        </StackPanel>
                        
                        <!-- Extract Mode -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="抽帧模式" 
                                       FontSize="13" 
                                       Foreground="#f5f5f5" 
                                       FontWeight="Medium" />
                            <ComboBox SelectedIndex="{Binding ExtractModeIndex}" 
                                      HorizontalAlignment="Stretch"
                                      Background="#1a1a1a"
                                      BorderBrush="#3f3f46">
                                <ComboBoxItem Content="定数抽帧" />
                                <ComboBoxItem Content="动态间隔抽帧" />
                                <ComboBoxItem Content="等时抽帧" />
                                <ComboBoxItem Content="关键帧抽取" />
                            </ComboBox>
                        </StackPanel>

                        <!-- Frame Count (for fixed/dynamic mode) -->
                        <StackPanel Spacing="8" IsVisible="{Binding IsFixedOrDynamicMode}">
                            <TextBlock Text="目标帧数" 
                                       FontSize="13" 
                                       Foreground="#f5f5f5" 
                                       FontWeight="Medium" />
                            <NumericUpDown Value="{Binding FrameCount}" 
                                           Minimum="1" 
                                           Maximum="100" 
                                           Increment="1"
                                           Background="#1a1a1a"
                                           BorderBrush="#3f3f46" />
                        </StackPanel>

                        <!-- Time Interval (for interval mode) -->
                        <StackPanel Spacing="8" IsVisible="{Binding IsIntervalMode}">
                            <TextBlock Text="时间间隔 (毫秒)" 
                                       FontSize="13" 
                                       Foreground="#f5f5f5" 
                                       FontWeight="Medium" />
                            <NumericUpDown Value="{Binding TimeInterval}" 
                                           Minimum="100" 
                                           Maximum="10000" 
                                           Increment="100"
                                           Background="#1a1a1a"
                                           BorderBrush="#3f3f46" />
                        </StackPanel>

                        <!-- Sensitivity (for dynamic mode) -->
                        <StackPanel Spacing="8" IsVisible="{Binding IsDynamicMode}">
                            <TextBlock Text="检测灵敏度" 
                                       FontSize="13" 
                                       Foreground="#f5f5f5" 
                                       FontWeight="Medium" />
                            <Slider Value="{Binding DetectionSensitivity}" 
                                    Minimum="0" 
                                    Maximum="1" 
                                    TickFrequency="0.1"
                                    IsSnapToTickEnabled="True" />
                            <TextBlock Text="{Binding DetectionSensitivity, StringFormat='灵敏度: {0:F1}'}" 
                                       FontSize="12" 
                                       Foreground="#71717a" 
                                       HorizontalAlignment="Right" />
                        </StackPanel>

                        <!-- Generate Button -->
                        <Button Classes="Primary" 
                                HorizontalAlignment="Stretch"
                                Command="{Binding ExtractFramesCommand}">
                            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                                <PathIcon Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" 
                                          Width="14" 
                                          Height="14" />
                                <TextBlock Text="执行抽帧" FontSize="13" />
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Border>

                <!-- AI Scene Analysis Section -->
                <Border Background="#18181b" 
                        BorderBrush="#27272a" 
                        BorderThickness="1" 
                        CornerRadius="8" 
                        Padding="16"
                        IsVisible="{Binding HasShots}">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <PathIcon Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" 
                                      Width="16" 
                                      Height="16" 
                                      Foreground="#8b5cf6" />
                            <TextBlock Text="AI 场景分析" 
                                       FontSize="14" 
                                       FontWeight="SemiBold" 
                                       Foreground="#f5f5f5" 
                                       VerticalAlignment="Center" />
                        </StackPanel>
                        
                        <TextBlock Text="对所有分镜进行智能场景识别和描述生成" 
                                   FontSize="12" 
                                   Foreground="#71717a" 
                                   TextWrapping="Wrap" />
                        
                        <Button Classes="Secondary" 
                                HorizontalAlignment="Stretch"
                                Command="{Binding AIAnalyzeAllCommand}">
                            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                                <PathIcon Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" 
                                          Width="14" 
                                          Height="14" />
                                <TextBlock Text="批量 AI 分析" FontSize="13" />
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Border>

                <!-- Project Stats -->
                <Border Background="#18181b" 
                        BorderBrush="#27272a" 
                        BorderThickness="1" 
                        CornerRadius="8" 
                        Padding="16">
                    <StackPanel Spacing="12">
                        <TextBlock Text="分镜统计" 
                                   FontSize="12" 
                                   Foreground="#71717a" />
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="{Binding Shots.Count}" 
                                       FontSize="32" 
                                       FontWeight="Bold" 
                                       Foreground="#8b5cf6" />
                            <TextBlock Text="个分镜" 
                                       FontSize="14" 
                                       Foreground="#f5f5f5" 
                                       VerticalAlignment="Bottom" 
                                       Margin="0,0,0,4" />
                        </StackPanel>
                        <Grid ColumnDefinitions="*,Auto" Margin="0,4,0,0">
                            <TextBlock Grid.Column="0" 
                                       Text="总时长" 
                                       FontSize="13" 
                                       Foreground="#71717a" />
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding TotalDuration, StringFormat='{}{0:F1}s'}" 
                                       FontSize="13" 
                                       Foreground="#f5f5f5" />
                        </Grid>
                    </StackPanel>
                </Border>

                <Border Height="80" Background="Transparent" />

            </StackPanel>
        </ScrollViewer>

    </Grid>

</UserControl>
